(function(win,doc){ENV={"3PTracker":1,AdID:133303,BrandID:1008,CookieID:"lVfWbuVHJMej",Domain:"contobox.com",ExternalIDs:"",FeatureFlag:{experimental:{enabled:!1}},FromURL:"https://www.gaf.com/en-us/roofing-materials/residential-roofing-materials/shingles/timberline-hdz",PluginName:"gaf",Prod:!0,WebsiteID:61,ZoneID:117813};try{win!==window.top&&window.top.document&&(win=window.top,doc=win.document)}catch{}ENV;var thirdpartytracker=ENV["3PTracker"];if(win.__ws_cb_tracker)return;win.__ws_cb_tracker=!0;var ENV,DBG_Mode=ENV.Prod===!1,DBG_CBSign="CB-Site-Tracker:",EndPointPath="https://cbdp."+ENV.Domain,ObserveInterval=100,LabelCollectInterval=2e3;win.__cb_SID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)}).replace(/-/g,"");var LabelType={CATEGORY:"category",NICHE:"niche",RELATED_CATEGORY:"related category",BRAND:"brand",PRODUCT:"product",PRODUCT_BRAND:"product brand",PRODUCT_SKU:"product sku",CONTENT:"content",ADDED_TO_CART:"add to cart",STATE_MAKE_MODEL:"state make model",STORE_ID:"store id",TIRE_SIZE:"tire size",APPLICATION:"application",TIRE_SIZE_APPLICATION:"tire size application",CONTENT_CATEGORIES:"content categories",LIFT_DESTINATIONS:"lift destinations",LIFT_EXPERIENCES:"lift experiences",SAVE_TO_LIST:"save_to_list",LISTING_TYPE:"ListingType",LIVING_AREA_SQ_FT:"LivingAreaSqFt",PROPERTY_TYPE:"PropertyType",LOCATION:"Location",PRICE:"Price",LISTING_AND_REGION:"ListingAndRegion",BEDROOMS:"Bedrooms",TOTAL_BATHS:"TotalBath",PROPERTY_STYLE:"PropertyStyle",YEAR_BUILT:"YearBuilt",VARIANT_CODE:"variant_code",POST_ID:"post_id",URL_PATH:"url_path",SUGGESTED_KEYWORDS:"suggested_keywords",SEARCH_KEYWORDS:"search_keywords",DESTINATION_FROM:"destination_from",DESTINATION_TO:"destination_to",DEPARTURE_DATE:"departure_date",RETURN_DATE:"return_date"},Payload={websiteID:ENV.WebsiteID,cbUserID:ENV.CookieID,aamUserID:"",brandID:ENV.BrandID,sid:win.__cb_SID,timeSpent:null,url:null,labels:null};ENV.ExternalIDs&&(Payload.ids=ENV.ExternalIDs.split(",").map(function(i){var eid=i.split(":");return{name:eid[0],id:eid[1]}}));var passParamsToTracker=!1;function main(){SiteTracker()}function SiteTracker(){var o=Object.assign({},{init:function(){log("init site tracking"),this.observeTimer=0,this.isSent=!1,this.observing=!1,this.href=win.location.href.split("#")[0],this.TimeSpent=TimeSpentTracker(),this.Labels=LabelCollector(),this.Plugin=SitePlugin(this),this.DSPTracker=DSPTracker(this.TimeSpent,this.Labels),this.handleLocationChange=this.handleLocationChange.bind(this),this.handlePageUnload=this.handlePageUnload.bind(this),this.assignZoneAndAd=this.assignZoneAndAd.bind(this);var ua=navigator.userAgent,iOS=ua.match(/iPad/i)||ua.match(/iPhone/i),pageunload=iOS?"pagehide":"beforeunload";return win.addEventListener(pageunload,this.handlePageUnload,!1),this.startObserving(),this},startObserving:function(){if(this.observing)return!1;log("start observing");var lbCt=0;return this.observeTimer=win.setInterval(function(){var href=win.location.href.split("#")[0];if(this.href!==href){this.handleLocationChange(href);return}lbCt+=ObserveInterval,lbCt>=LabelCollectInterval&&(this.Plugin.collect(this.Labels,"observe"),this.DSPTracker.timespentMatched(),this.DSPTracker.ruleMatched(this.Labels.get()),lbCt=0)}.bind(this),ObserveInterval),this.observing=!0,this.Labels.on("update",this.DSPTracker.ruleMatched.bind(this.DSPTracker)),!0},stopObserving:function(){return!!this.observing&&(log("stop observing"),win.clearInterval(this.observeTimer),this.Plugin.collect(this.Labels,"stop"),this.observing=!1,this.Labels.off("update",this.DSPTracker.ruleMatched.bind(this.DSPTracker)),!0)},assignZoneAndAd:function(currentPayload){return ENV.ZoneID&&ENV.AdID?Object.assign({},currentPayload,{adID:ENV.AdID,zoneID:ENV.ZoneID}):currentPayload},send:function(){if(this.isSent)return log("send:","data is already sent"),!1;var labels=this.Labels.get();if(!labels.length)return log("send:","no labels"),!1;if(doc.documentElement.lang!==""&&typeof doc.documentElement.lang.split("-")[0]!="undefined")var lang=doc.documentElement.lang.split("-")[0];else var lang="en";var timeSpent=this.TimeSpent.timeSpent(),p=this.assignZoneAndAd(Payload),payload=Object.assign({},p,{timeSpent,eventType:"website_label",url:this.href,lang:p.lang?p.lang:lang,labels,version:2,fromURL:ENV.FromURL});return log("send:",JSON.stringify(payload,null,2)),sendBeacon(EndPointPath+"/wslabel",payload,function(queued){queued?log("send:","the user activity is queued to send."):log("send:","the user activity failed to queue.")}),this.isSent=!0,!0},handleLocationChange:function(href){log("location changed to:",href),this.stopObserving(),this.send(),this.TimeSpent.reset(),this.Labels.reset(),this.DSPTracker=DSPTracker(this.TimeSpent,this.Labels),this.href=href,this.isSent=!1,this.startObserving()},handlePageUnload:function(){log("page unload"),this.stopObserving(),this.send()}});return o.init()}Observable={__calls:[],on:function(when,fn){this.__calls.push({when,fn})},off:function(when,fn){this.__calls=this.__calls.filter(function(c){return c.when!==when&&c.fn!==fn})},trigger:function(when,data){var context=this;this.__calls.forEach(function(c){c.when===when&&c.fn.call(context,data)})}};function LabelCollector(){var store={};return Object.assign({},Observable,{add:function(type,label){if(isArray(label)||(label=[label]),label=label.map(function(lb){return/number|string/.test(typeof lb)||(lb=""),String(lb).trim()}),label=label.filter(function(lb){return lb!==""}),!label.length)return;return label.forEach(function(lb){type in store||(store[type]=[]),store[type].indexOf(lb)===-1&&store[type].push(lb)}),this.trigger("update",this.get()),this},get:function(){var labels=[];return Object.keys(store).forEach(function(key){labels.push({type:key,values:store[key]})}),labels},reset:function(){store={},this.trigger("update",this.get()),this.trigger("reset")}})}function TimeSpentTracker(){var timeSpent=0,startTime=0,duration=0,lastEventTime=0,MIN_INT_DURATION=1e3,EVENT_TIMEOUT=8e3,isIElt10=/MSIE [8-9]/.test(navigator.userAgent),visPref=function(){var i,prefixes=["webkit","moz","ms","o"];if("hidden"in doc)return"";for(i=0;i<prefixes.length;i++)if(prefixes[i]+"Hidden"in doc)return prefixes[i];return""}(),visEvent=visPref+"visibilitychange",o=Object.assign({},{init:function(){if(log("init time-spent tracking"),this.handleInteraction=this.handleInteraction.bind(this),this.handleFocusOut=this.handleFocusOut.bind(this),this.handleVisibilityChange=this.handleVisibilityChange.bind(this),doc.addEventListener("mousemove",this.handleInteraction,!1),doc.addEventListener("touchmove",this.handleInteraction,!1),doc.addEventListener("click",this.handleInteraction,!1),doc.addEventListener("touchend",this.handleInteraction,!1),win.addEventListener("scroll",this.handleInteraction,!1),win.addEventListener("mousewheel",this.handleInteraction,!1),win.addEventListener("DOMMouseScroll",this.handleInteraction,!1),doc.addEventListener(visEvent,this.handleVisibilityChange,!1),isIElt10?doc.addEventListener("focusout",this.handleFocusOut,!1):win.addEventListener("blur",this.handleFocusOut,!1),win&&win.ShopifyAnalytics){var shopify_data=win&&win.ShopifyAnalytics;shopify_data&&typeof shopify_data.subscribe!="undefined"&&(shopify_data.subscribe("clicked",this.handleInteraction),shopify_data.subscribe("pageInteractions",this.handleInteraction))}return this},handleFocusOut:function(){this.updateTimeSpent()},handleVisibilityChange:function(){var hidden=(visPref===""?"h":visPref+"H")+"idden";typeof doc[hidden]!="undefined"&&doc[hidden]===!1&&this.updateTimeSpent()},handleInteraction:function(){var time=Date.now();startTime>0&&(time-lastEventTime>EVENT_TIMEOUT?this.updateTimeSpent():duration=time-startTime),startTime===0&&(startTime=time,duration=0),lastEventTime=time},updateTimeSpent:function(){return startTime>0&&(this.addTimeSpent(Math.max(MIN_INT_DURATION,duration)),startTime=duration=0),this},addTimeSpent:function(time){return timeSpent+=time,this},timeSpent:function(ms){return startTime>0&&this.updateTimeSpent(),ms?timeSpent:Math.max(1,Math.round(timeSpent/1e3))},reset:function(){timeSpent=0}});return o.init()}function DSPTracker(TimeSpent,collector){var d,labelsForRule=[];function strnormalize(s){return s.toLowerCase().trim().replace(/[^a-zA-ZÀ-ÖØ-öø-ÿ0-9]+/g,"_").replace(/^_|_$/g,"")}function hasAllMatchedLabels(labelLoad,foundLabels){var i,g,j,labelMap={};foundLabels.forEach(function(g){labelMap[strnormalize(g.type)]=g.values});for(i=0;i<labelLoad.length;i++){if(g=labelLoad[i],!(g.type in labelMap))return!1;for(j=0;j<g.values.length;j++)if(labelMap[g.type].indexOf(g.values[j])===-1)return!1}return!0}function callTagsAndLabelLoad(label,labels){label.label_load&&label.label_load.length?(hasAllMatchedLabels(label.label_load,labels)&&this.callTags(label.tracker),label.label_load.forEach(function(lb){collector.add(lb.type,lb.values)})):this.callTags(label.tracker)}function checkSegmentsAndCallTag(This,label){var labelArr=labelsForRule.map(function(l){return strnormalize(l.type)}),labelVal=[];label.rule.segments.map(function(seg){labelArr.indexOf(strnormalize(seg.name))!==-1&&(labelVal=labelsForRule.filter(function(lab){return strnormalize(lab.type)===strnormalize(seg.name)})[0].values.map(function(val){return strnormalize(val)}),seg.values.map(function(sv){labelVal.indexOf(strnormalize(sv))!==-1&&(This.callTags(label.tracker),label.label_load&&label.label_load.length&&label.label_load.forEach(function(lb){collector.add(lb.type,lb.values)}),Object.assign(label,{called:!0}))}.bind(this)))}.bind(this))}return d=Object.assign({},{TimeSpent,ruleMatched:function(labels){labelsForRule=labels,this.data&&this.data.rules&&this.data.rules.map(function(label){if(label.matched&&!label.called)if(!label.rule||!label.rule.segments||!label.rule.segments.length)Object.assign(label,{called:!0}),callTagsAndLabelLoad.call(this,label,labels);else{if(typeof label.rule.client_triggers!="undefined")return;var labelArr=labels.map(function(l){return strnormalize(l.type)}),labelVal=[];label.rule.segments.map(function(seg){labelArr.indexOf(strnormalize(seg.name))!==-1&&(labelVal=labels.filter(function(lab){return strnormalize(lab.type)===strnormalize(seg.name)})[0].values.map(function(val){return strnormalize(val)}),seg.values.map(function(sv){labelVal.indexOf(strnormalize(sv))!==-1&&(Object.assign(label,{called:!0}),callTagsAndLabelLoad.call(this,label,labels))}.bind(this)))}.bind(this))}else if(typeof label.rule!="undefined"&&Object.keys(label.rule).length>0&&typeof label.rule.segments!="undefined"){if(typeof label.rule.client_triggers!="undefined")return;var labelArray=labels.map(function(l){return strnormalize(l.type)}),labelValues=[],timeSpent=this.TimeSpent.timeSpent(),matchedBrackets=Object.keys(this.data.brackets).filter(function(b){return timeSpent>=this.data.brackets[b]}.bind(this));matchedBrackets.indexOf(label.bracket)!==-1&&label.rule.segments.map(function(segment){labelArray.indexOf(strnormalize(segment.name))!==-1&&(labelValues=labels.filter(function(l){return strnormalize(l.type)===strnormalize(segment.name)})[0].values.map(function(v){return strnormalize(v)}),segment.values.map(function(s){labelValues.indexOf(strnormalize(s))!==-1&&!label.called&&(Object.assign(label,{called:!0}),callTagsAndLabelLoad.call(this,label,labels))}.bind(this)))}.bind(this))}}.bind(this))},timespentMatched:function(){if(!this.data||!this.data.brackets||!this.data.rules)return;var timeSpent=this.TimeSpent.timeSpent(),brackets=Object.keys(this.data.brackets).filter(function(b){return timeSpent>=this.data.brackets[b]}.bind(this)),unmatched=this.data.rules.filter(function(r){return r.matched===!1&&Object.keys(r.rule).length===0});if(!unmatched.length||!brackets.length)return;unmatched.forEach(function(u){var mb=u.bracket==="*"||!!brackets.filter(function(b){return u.bracket===b}).length;mb&&(Object.assign(u,{called:!0,matched:!0}),this.callTags(u.tracker),u.label_load&&u.label_load.length&&u.label_load.forEach(function(lb){collector.add(lb.type,lb.values)}))}.bind(this))},manageClientTriggers:function(type,value){this.data&&this.data.rules&&this.data.rules.map(function(label){var This=this;if(label.called||typeof label.rule.client_triggers=="undefined")return;var clientTriggers=label.rule.client_triggers.map(function(t){return t.name}),clientValues=label.rule.client_triggers.filter(function(t){return t.name===type});if(clientTriggers.indexOf(type)!==-1){var called=!1;clientValues.length>0&&clientValues.map(function(cv){cv.values&&cv.values.length>0&&value?cv.values.map(function(v){v===value&&!called&&(typeof label.rule.segments!="undefined"&&typeof labelsForRule!="undefined"?checkSegmentsAndCallTag(This,label):(This.callTags(label.tracker),label.label_load&&label.label_load.length&&label.label_load.forEach(function(lb){collector.add(lb.type,lb.values)}),called=!0,Object.assign(label,{called:!0})))}):typeof label.rule.segments!="undefined"&&typeof labelsForRule!="undefined"?checkSegmentsAndCallTag(This,label):(This.callTags(label.tracker,value),label.label_load&&label.label_load.length&&label.label_load.forEach(function(lb){collector.add(lb.type,lb.values)}),called=!0,Object.assign(label,{called:!0}))})}}.bind(this))},manageUrlPatterns:function(value){this.data&&this.data.rules&&this.data.rules.forEach(function(label){var This=this;if(label.called||typeof label.rule.client_triggers=="undefined")return;var clientTriggers=label.rule.client_triggers.map(function(t){return t.name}),clientValues=label.rule.client_triggers.filter(function(t){return t.name==="URL_PATTERN"});if(clientTriggers.indexOf("URL_PATTERN")!==-1){var called=!1;clientValues.length>0&&clientValues.forEach(function(cv){cv.values&&cv.values.length>0&&cv.values.forEach(function(v){var re=new RegExp(v,"g");re.test(value)&&!called&&(label.tracker?(This.callTags(label.tracker),label.label_load&&label.label_load.length&&label.label_load.forEach(function(lb){collector.add(lb.type,lb.values)}),called=!0,Object.assign(label,{called:!0})):label.label_load&&label.label_load.length&&label.label_load.forEach(function(lb){collector.add(lb.type,lb.values)}))})})}}.bind(this))},callTags:function(tracker,value){if(typeof tracker!="undefined"&&thirdpartytracker!==0){if(value&&value.items&&value.items.length>0&&passParamsToTracker){var ts,t,tf,products={},order_id=value.order_id?value.order_id:1,arrSku=[],price=0,total_price=0,total_quantity=0;value.items.forEach(function(item){sku=item&&item.sku,sku&&arrSku.push(item.sku),price=item&&item.price,quantity=item&&item.qty,total_price=price&&!Number.isNaN(parseFloat(price))?total_price+parseFloat(price):total_price,total_quantity=quantity&&!Number.isNaN(parseInt(quantity))?total_quantity+parseInt(quantity):total_quantity}),products={SKU:arrSku.toString(),REVENUE:total_price,QUANTITY:total_quantity,TRANSACTIONID:order_id},tracker=tracker.replace(/SKU|REVENUE|QUANTITY|TRANSACTIONID/gi,function(matched){return products[matched]})}ts=parseInt((new Date).getTime()/1e3,10),t=tracker.replace("[timestamp]",ts),tf=doc.createElement("iframe"),tf.id="cbox-fn-"+ts,tf.src="",tf.setAttribute("width",1),tf.setAttribute("height",1),tf.setAttribute("frameborder","no"),tf.setAttribute("scrolling","no"),tf.style.display="none",doc.body.appendChild(tf);try{tf.contentWindow.document.open("text/html","replace"),tf.contentWindow.document.write("<!DOCTYPE html><html><head></head><body>"+t+"</body></html>"),tf.contentWindow.document.close()}catch{tf.src="data:text/html;charset=utf-8,<!DOCTYPE html><html><head></head><body>"+t+"</body></html>"}}},init:function(){if(this.loading||this.ready)return;this.loading=!0;var _t=this,xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200)try{_t.data=JSON.parse(xhttp.responseText),_t.data.brackets=_t.data.brackets||{},_t.data.rules=_t.data.rules||[],_t.ready=!0,_t.loading=!1,_t.callTags(),_t.manageUrlPatterns(win.location.href)}catch{}};var externalIDs="";ENV.ExternalIDs?externalIDs="&external_ids="+ENV.ExternalIDs:Payload.ids&&(externalIDs="&external_ids="+Payload.ids.map(function(i){return i.name+":"+i.id}).join(","));var registeredUser="";typeof Payload.isMember!="undefined"&&(registeredUser="&is_member="+Payload.isMember);var retailerId="";return typeof Payload.retailerID!="undefined"&&(retailerId="&retailer_id="+Payload.retailerID),xhttp.open("GET",EndPointPath+"/wsrule?website_id="+ENV.WebsiteID+"&brand_id="+ENV.BrandID+"&cb_user_id="+ENV.CookieID+externalIDs+registeredUser+retailerId,!0),xhttp.send(),this}}),win.__cb_dsp_tracker=d,d.init()}function sendBeacon(url,params,callback){var queued=navigator.sendBeacon(url,JSON.stringify(params||{}));callback&&callback(queued)}function isArray(obj){return Object.prototype.toString.call(obj)==="[object Array]"}function callCBtracker(src){var ts=parseInt((new Date).getTime()/1e3,10),s=`<script type="text/javascript">document.write('<iframe src="`+src+`" width="1" height="1" frameborder="0" style="display:none"></iframe>');<\/script><noscript><iframe src="`+src+'" width="1" height="1" frameborder="0" style="display:none"></iframe></noscript>',tf=doc.createElement("iframe");tf.id="cbox-fn-"+ts,tf.setAttribute("width",1),tf.setAttribute("height",1),tf.setAttribute("frameborder","no"),tf.setAttribute("scrolling","no"),tf.style.display="none",doc.body.appendChild(tf),tf.contentWindow.document.open("text/html","replace"),tf.contentWindow.document.write("<!DOCTYPE html><html><head></head><body>"+s+"</body></html>"),tf.contentWindow.document.close()}typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(target){"use strict";if(target==null)throw new TypeError("Cannot convert undefined or null to object");for(var to=Object(target),index=1;index<arguments.length;index++){var nextKey,nextSource=arguments[index];if(nextSource!=null)for(nextKey in nextSource)Object.prototype.hasOwnProperty.call(nextSource,nextKey)&&(to[nextKey]=nextSource[nextKey])}return to},writable:!0,configurable:!0}),!function(t,e){e()}(0,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}var e=function(t){return"string"==typeof t},n=function(t){return t instanceof Blob};(function(){"navigator"in this||(this.navigator={}),"function"!=typeof this.navigator.sendBeacon&&(this.navigator.sendBeacon=function(t,o){var i=this.event&&this.event.type,r="unload"===i||"beforeunload"===i,f="XMLHttpRequest"in this?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.open("POST",t,!r),f.withCredentials=!0,f.setRequestHeader("Accept","*/*"),e(o)?(f.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),f.responseType="text"):n(o)&&o.type&&f.setRequestHeader("Content-Type",o.type);try{f.send(o)}catch{return!1}return!0}.bind(this))}).call("object"===("undefined"==typeof window?"undefined":t(window))?window:{})});function log(){if(!DBG_Mode)return;var args=[].map.call(arguments,function(arg){return arg});console.log.apply(console,[DBG_CBSign].concat(args))}function validateConversionArgs(args){var validItems=[];return!!args.items&&args.items.length!==0&&(args.items.forEach(function(item){item&&item.sku&&validItems.push(item)}),validItems.length!==0)}function assignZoneAndAd(currentPayload){return ENV.ZoneID&&ENV.AdID?Object.assign({},currentPayload,{adID:ENV.AdID,zoneID:ENV.ZoneID,fromURL:ENV.FromURL}):currentPayload}function omitEmptyObject(obj){return Object.keys(obj).reduce(function(acc,k){return obj[k]!==null&&obj[k]!==0&&typeof obj[k]!="undefined"&&(acc[k]=obj[k]),acc},{})}function buildEventObject(sku,name,orderId,quantity,price){if(sku==="")return;var obj={eventValue:sku,eventLabel:name,quantity:parseInt(quantity),orderID:orderId.toString(),price:parseFloat(price)};return omitEmptyObject(obj)}function addCartEventData(payload,data){var obj,sku="",params=[LabelType.PRODUCT_SKU],skuObject=data.filter(function(d){return params.includes(d.type)});return skuObject[0]&&skuObject[0].values&&skuObject[0].values.length?(obj=buildEventObject(skuObject[0].values[0],null,"",0,0),Object.assign({},payload,{eventData:[obj]})):payload}function getRetailer(id){id&&Object.assign(Payload,{retailerID:id})}function getProduct(id){id&&Object.assign(Payload,{productID:id})}function getLanguage(lang){lang&&Object.assign(Payload,{lang})}function getAntiNormalizer(noNorm){noNorm&&Object.assign(Payload,{noNorm:!0})}function getMember(member){typeof member!="undefined"&&Object.assign(Payload,{isMember:member})}function getTPIndentifiers(args){args&&Array.isArray(args.ids)&&Object.assign(Payload,{ids:args.ids.map(function(i){return i})})}function sendLabels(collector,labels,type,conversionItems){var p,ls=labels&&labels.length?labels:collector.get(),saveToList=type==="website_save_to_list",removeFromList=type==="website_remove_from_list";if(doc.documentElement.lang!==""&&typeof doc.documentElement.lang.split("-")[0]!="undefined")var lang=doc.documentElement.lang.split("-")[0];else var lang="en";if(ls.length){p=assignZoneAndAd(Payload),(type==="website_add_to_cart"||type==="website_save_to_list")&&(p=addCartEventData(p,ls)),type==="website_conversion"&&(p.eventData=conversionItems);var payload=Object.assign({},p,{timeSpent:saveToList?250:500,url:win.location.href.split("#")[0],lang:p.lang?p.lang:lang,labels:ls,eventType:type,version:2,fromURL:ENV.FromURL}),payLoadReset=Object.assign({},p,{timeSpent:removeFromList?250:500,url:win.location.href.split("#")[0],lang:p.lang?p.lang:lang,labels:ls,action:"delete",eventType:type,version:2,fromURL:ENV.FromURL});type==="website_reset_cart"||type==="website_remove_from_list"?sendBeacon(EndPointPath+"/labels/reset",payLoadReset,function(queued){queued?log("send:","the user activity is queued to send."):log("send:","the user activity failed to queue.")}):sendBeacon(EndPointPath+"/wslabel",payload,function(queued){queued?log("send:","the user activity is queued to send."):log("send:","the user activity failed to queue.")})}}function prepareAndSendConversionPayload(collector,args){var products=[],total=0,qty=0;args.items.forEach(function(item){var productObject=buildEventObject(item.sku,"",args.order_id,item.qty,item.price);products.push(productObject),item.sku&&(total=total+parseFloat(item.price),qty=qty+parseInt(item.qty),collector.add("conversion",item.sku))});var labels=collector.get();labels.forEach(function(l){l.type==="conversion"&&(l.data={orderID:args.order_id?args.order_id.toString():"",qty,total})}),sendLabels(collector,labels,"website_conversion",products)}function waitForDSPTracker(type,value){if(win.__cb_dsp_tracker&&win.__cb_dsp_tracker.ready===!0&&win.__cb_dsp_tracker.manageClientTriggers&&typeof win.__cb_dsp_tracker.manageClientTriggers=="function")win.__cb_dsp_tracker.manageClientTriggers(type,value);else var waitingInterval=setInterval(function(){win.__cb_dsp_tracker&&win.__cb_dsp_tracker.ready===!0&&win.__cb_dsp_tracker.manageClientTriggers&&typeof win.__cb_dsp_tracker.manageClientTriggers=="function"&&(win.__cb_dsp_tracker.manageClientTriggers(type,value),clearInterval(waitingInterval))},500)}win&&(win.cbtag=function(event,args,customData){var l=LabelCollector();switch(event){case"add_to_cart":args&&args.sku&&(l.add(LabelType.ADDED_TO_CART,args.sku),l.add(LabelType.PRODUCT_SKU,args.sku),sendLabels(l,[],"website_add_to_cart"),waitForDSPTracker("ADD_TO_CART",args.sku));break;case"conversion":args&&validateConversionArgs(args)&&(prepareAndSendConversionPayload(l,args),waitForDSPTracker("CONVERSION",args));break;case"reset_cart":args&&args.sku&&(l.add(LabelType.ADDED_TO_CART,args.sku),l.add(LabelType.PRODUCT_SKU,args.sku),sendLabels(l,[],"website_reset_cart"));break;case"save_to_list":args&&args.sku&&(l.add(LabelType.SAVE_TO_LIST,args.sku),l.add(LabelType.PRODUCT_SKU,args.sku),sendLabels(l,[],"website_save_to_list"));break;case"remove_from_list":args&&args.sku&&(l.add(LabelType.SAVE_TO_LIST,args.sku),l.add(LabelType.PRODUCT_SKU,args.sku),sendLabels(l,[],"website_remove_from_list"));break;case"set_email":args&&getTPIndentifiers(args);break;case"website_intent":if(customData=customData||{},!args)return;Object.assign(Payload,customData),Object.keys(LabelType).forEach(function(existedLabel){LabelType[existedLabel]&&args.hasOwnProperty(LabelType[existedLabel])&&l.add(LabelType[existedLabel],args[LabelType[existedLabel]])}),sendLabels(l,[],"website_intent");break;default:}},win.cbtagdata&&win.cbtagdata.length&&win.cbtagdata.forEach(function(d){win.cbtag(d.event,d.args,d.customData)})),main();function SitePlugin(){var BLACKLIST_CATEGORY=["All","Shop All","Home","No Category"],MATCHES=[{reg:"shingles",category:["shingles"]},{reg:"leak-barriers",category:["leak_barriers"]},{reg:"hip-and-ridgecap-shingles",category:["hip_&_ridge_cap_shingles"]},{reg:"ventilation-and-attic-vents",category:["ventilation_&_attic_vents"]},{reg:"roof-deck-protection",category:["roof_deck_protection"]},{reg:"starter-strip-shingles",category:["starter_strips"]},{reg:"signup",category:["signup"]},{reg:"timberline-hdz",sku:"309755006"},{reg:"timberline-natural-shadow",sku:"100658107"},{reg:"royal-sovereign",sku:"100046024"},{reg:"timberline-hdz-rs",sku:"313685348"},{reg:"weatherwatch",sku:"100083257"},{reg:"timbertex",sku:"100658126"},{reg:"seal-a-ridge",sku:"206749725"},{reg:"cobra-rigid-vent-3",sku:"202564468"},{reg:"cobra-snow-country",sku:"206940210"},{reg:"cobra-snow-country-advanced",sku:"100027903"},{reg:"master-flow-slant-back-aluminum-roof-louver-ssb960a",sku:"100041904"},{reg:"master-flow-power-attic-vent-egv6-gable-mount",sku:"205924917"},{reg:"master-flow-power-attic-vent-erv6-roof-mount",sku:"207161914"},{reg:"felt-buster",sku:"205035868"},{reg:"pro-start",sku:"202052408"},{reg:"quickstart",sku:"203225503"}],o=Object.assign({},{init:function(){return log("init site plugin `"+ENV.PluginName+"`"),this},collect:function(labels){var e,t,i,c,l,d,p,This=this;__cb_dsp_tracker.manageUrlPatterns(window.location.pathname),window.location.pathname.split("/").indexOf("roofing-products")>0&&(l=window.location.pathname.split("/"),l.length>0&&[].forEach.call(l,function(t){This.appendPreDefinedLabels(labels,t)}))},appendPreDefinedLabels:function(labels,term){MATCHES.forEach(function(m){m.reg===term&&(m.category&&labels.add(LabelType.CATEGORY,m.category),m.sku&&labels.add(LabelType.PRODUCT_SKU,m.sku),m.relatedCategory&&labels.add(LabelType.RELATED_CATEGORY,m.relatedCategory))})}});return o.init()}})(window,document)